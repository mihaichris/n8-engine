PREFIX :        <http://n8.org/#>
PREFIX fuseki:  <http://jena.apache.org/fuseki#>
PREFIX rdf:     <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
PREFIX rdfs:    <http://www.w3.org/2000/01/rdf-schema#>
PREFIX ja:      <http://jena.hpl.hp.com/2005/11/Assembler#>
PREFIX tdb2:    <http://jena.apache.org/2016/tdb#>
PREFIX text:    <http://jena.apache.org/text#>
PREFIX dc:      <http://purl.org/dc/elements/1.1/>


[]
    rdf:type        fuseki:Server ;
    fuseki:services ( :service ) .

## Service description for "/dataset"
## with a TDB2 dataset and a text index.

:service
    rdf:type        fuseki:Service ;
    fuseki:name     "dataset" ;
    fuseki:endpoint [ fuseki:operation fuseki:query ;
                      fuseki:name      "sparql" ] ;
    fuseki:endpoint [ fuseki:operation fuseki:query ;
                      fuseki:name      "query" ] ;
    fuseki:endpoint [ fuseki:operation fuseki:update ;
                      fuseki:name      "update" ] ;
    fuseki:endpoint [ fuseki:operation fuseki:gsp-r ;
                      fuseki:name      "get" ] ;
    fuseki:endpoint [ fuseki:operation fuseki:gsp-rw ;
                      fuseki:name      "data" ] ;
    fuseki:endpoint [ fuseki:operation fuseki:upload ;
                      fuseki:name      "upload" ] ;
    fuseki:dataset  :text_dataset ;
.

# TDB
[]
    ja:loadClass "org.apache.jena.tdb2.TDB2" .

tdb2:DatasetTDB
    rdfs:subClassOf ja:RDFDataset .

tdb2:GraphTDB
    rdfs:subClassOf ja:Model .

# Text
[]
    ja:loadClass "org.apache.jena.query.text.TextQuery" .

text:TextDataset
    rdfs:subClassOf ja:RDFDataset .

text:TextIndexLucene
    rdfs:subClassOf text:TextIndex .

## ---------------------------------------------------------------
## This URI must be fixed - it's used to assemble the text dataset.

:text_dataset
    rdf:type     text:TextDataset ;
    text:dataset :base_dataset ;
    text:index   :indexLucene ;
.

:base_dataset
    rdf:type      tdb2:DatasetTDB2 ;
    tdb2:location "E:/Java Projects/n8-engine/src/main/resources/tdb2/lucene"
.

:indexLucene
    a                        text:TextIndexLucene ;
    text:directory           "E:/Java Projects/n8-engine/src/main/resources/index/lucene" ;
    text:storeValues         true ;
    text:analyzer            [ a text:SimpleAnalyzer ] ;
    text:queryAnalyzer       [
                                 a text:ConfigurableAnalyzer ;
                                 text:tokenizer text:KeywordTokenizer ;
                                 text:filters (text:ASCIIFoldingFilter text:LowerCaseFilter)
                             ] ;
#        text:analyzer  [ a              text:GenericAnalyzer ;
#                         text:class "com.example.n8engine.semantic.analyzer.SemanticAnalyzer" ;
#                       ];
#            text:queryAnalyzer [a              text:GenericAnalyzer ;
#                                text:class "com.example.n8engine.semantic.analyzer.SemanticAnalyzer" ];
    text:queryParser         text:ComplexPhraseQueryParser ;
#    text:propLists ( [ . . . ] . . . ) ;
    text:entityMap           :entMap ;
    text:multilingualSupport true ;
.

:entMap
    a                 text:EntityMap ;
    text:entityField  "uri" ;
    text:defaultField "text" ;
    text:graphField   "graph" ; ## enable graph-specific indexing
    text:uidField     "uid" ; ## Must be defined in the text:maps
    text:langField    "lang" ;
    text:map          (
                          [ text:field     "text" ;
                          text:predicate rdfs:label ;
#                          text:analyzer  [ a              text:GenericAnalyzer ;
#                                               text:class "com.example.n8engine.semantic.analyzer.SemanticAnalyzer" ;
##                                           text:class "com.example.n8engine.semantic.analyzer.SemanticAnalyzer" ;
##                                           text:stopWords ( "a" "an" "and" "but" )
#                                         ]
#                                text:analyzer [
#                                                  a text:GenericAnalyzer ;
#                                                  text:class "org.apache.lucene.analysis.en.EnglishAnalyzer" ;
#                                                  text:params (
#                                                        [ text:paramName "stopwords" ;
#                                                          text:paramType text:TypeSet ;
#                                                          text:paramValue ("the" "a" "an") ]
#                                                        [ text:paramName "stemExclusionSet" ;
#                                                          text:paramType text:TypeSet ;
#                                                          text:paramValue ("ing" "ed") ]
#                                                    )
#                                              ]
                        ]
                        [ text:field     "label" ;
                          text:predicate rdfs:label ]
                        [ text:field     "title" ;
                          text:predicate dc:title ]
                        [ text:field     "description" ;
                          text:predicate dc:description ]
                        [ text:field     "comment" ;
                          text:predicate rdfs:comment ] ) .