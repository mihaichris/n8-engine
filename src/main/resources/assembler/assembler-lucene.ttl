PREFIX n8:      <http://n8.org/#>
PREFIX fuseki:  <http://jena.apache.org/fuseki#>
PREFIX rdf:     <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
PREFIX rdfs:    <http://www.w3.org/2000/01/rdf-schema#>
PREFIX ja:      <http://jena.hpl.hp.com/2005/11/Assembler#>
PREFIX tdb2:    <http://jena.apache.org/2016/tdb#>
PREFIX text:    <http://jena.apache.org/text#>
PREFIX dc:      <http://purl.org/dc/elements/1.1/>
PREFIX skos:    <http://www.w3.org/2004/02/skos/core#>


[]
    rdf:type        fuseki:Server ;
    fuseki:services ( n8:service ) .

## Service description for "/dataset"
## with a TDB2 dataset and a text index.

n8:service
    rdf:type        fuseki:Service ;
    fuseki:name     "dataset" ;
    fuseki:endpoint [ fuseki:operation fuseki:query ;
                      fuseki:name      "sparql" ] ;
    fuseki:endpoint [ fuseki:operation fuseki:query ;
                      fuseki:name      "query" ] ;
    fuseki:endpoint [ fuseki:operation fuseki:update ;
                      fuseki:name      "update" ] ;
    fuseki:endpoint [ fuseki:operation fuseki:gsp-r ;
                      fuseki:name      "get" ] ;
    fuseki:endpoint [ fuseki:operation fuseki:gsp-rw ;
                      fuseki:name      "data" ] ;
    fuseki:endpoint [ fuseki:operation fuseki:upload ;
                      fuseki:name      "upload" ] ;
    fuseki:dataset  n8:text_dataset ;
.

# TDB
[]
    ja:loadClass "org.apache.jena.tdb2.TDB2" .

tdb2:DatasetTDB
    rdfs:subClassOf ja:RDFDataset .

tdb2:GraphTDB
    rdfs:subClassOf ja:Model .

# Text
[]
    ja:loadClass "org.apache.jena.query.text.TextQuery" .

text:TextDataset
    rdfs:subClassOf ja:RDFDataset .

text:TextIndexLucene
    rdfs:subClassOf text:TextIndex .

## ---------------------------------------------------------------
## This URI must be fixed - it's used to assemble the text dataset.

n8:text_dataset
    rdf:type     text:TextDataset ;
    text:dataset n8:base_dataset ;
    text:index   n8:indexLucene ;
.

n8:base_dataset
    rdf:type      tdb2:DatasetTDB2 ;
    tdb2:location "E:/Java Projects/tdb2/lucene"
.

n8:indexLucene
    a                        text:TextIndexLucene ;
    text:directory           "E:/Java Projects/n8-engine/src/main/resources/index/lucene" ;
    text:storeValues         true ;
    text:analyzer            [ a          text:GenericAnalyzer ;
                               text:class "com.example.n8engine.semantic.analyzer.SemanticAnalyzer" ; ] ;
#    text:queryAnalyzer            [ a          text:GenericAnalyzer ;
#                               text:class "com.example.n8engine.semantic.analyzer.SemanticQueryAnalyzer" ; ] ;
#    text:queryAnalyzer       [ a text:LowerCaseKeywordAnalyzer ] ;
#    text:queryAnalyzer       [ a              text:ConfigurableAnalyzer ;
#                               text:tokenizer text:KeywordTokenizer ;
#                               text:filters   ( text:ASCIIFoldingFilter text:LowerCaseFilter ) ; ] ;
    text:queryParser         text:ComplexPhraseQueryParser ;
    text:propLists           ( [ text:propListProp n8:text ;
                                 text:props        ( skos:prefLabel
                                                     skos:altLabel
                                                     rdfs:label
                                                     dc:title
                                                     dc:description
                                                     rdfs:comment ) ]
                               [ text:propListProp n8:label ;
                                 text:props        ( skos:prefLabel
                                                     skos:altLabel
                                                     rdfs:label ) ] ) ;
    text:entityMap           n8:entMap ;
    text:multilingualSupport true ;
.

n8:entMap
    a                 text:EntityMap ;
    text:entityField  "uri" ;
    text:defaultField "text" ;
    text:graphField   "graph" ;
    text:uidField     "uid" ;
    text:langField    "lang" ;
    text:map          ( [ text:field     "text" ;
                          text:predicate rdfs:label ]
                        [ text:field     "textComposed" ;
                          text:predicate n8:text ]
                        [ text:field     "label" ;
                          text:predicate n8:label ]
                        [ text:field     "preservedLabel" ;
                          text:predicate rdfs:label ]
                        [ text:field     "title" ;
                          text:predicate dc:title ]
                        [ text:field     "description" ;
                          text:predicate dc:description ]
                        [ text:field     "comment" ;
                          text:predicate rdfs:comment ]
                        [ text:field     "prefLabel" ;
                          text:predicate skos:prefLabel ]
                        [ text:field     "altLabel" ;
                          text:predicate skos:altLabel ] ) .