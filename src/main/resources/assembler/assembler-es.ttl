# Licensed to the Apache Software Foundation (ASF) under one
# or more contributor license agreements.  See the NOTICE file
# distributed with this work for additional information
# regarding copyright ownership.  The ASF licenses this file
# to you under the Apache License, Version 2.0 (the
# "License"); you may not use this file except in compliance
# with the License.  You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

@prefix :       <http://n8.ro/#> .
@prefix fuseki: <http://jena.apache.org/fuseki#> .
@prefix rdf:    <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
@prefix rdfs:   <http://www.w3.org/2000/01/rdf-schema#> .
@prefix ja:     <http://jena.hpl.hp.com/2005/11/Assembler#> .
@prefix tdb2:   <http://jena.apache.org/2016/tdb#> .
@prefix text:   <http://jena.apache.org/text#> .


[] rdf:type        fuseki:Server ;
   fuseki:services ( :service ) .

## Service description for "/dataset"
## with a TDB2 dataset and a text index.

:service
    rdf:type        fuseki:Service ;
    fuseki:name     "dataset" ;
    fuseki:endpoint [ fuseki:operation fuseki:query ;
                      fuseki:name      "sparql" ] ;
    fuseki:endpoint [ fuseki:operation fuseki:query ;
                      fuseki:name      "query" ] ;
    fuseki:endpoint [ fuseki:operation fuseki:update ;
                      fuseki:name      "update" ] ;
    fuseki:endpoint [ fuseki:operation fuseki:gsp-r ;
                      fuseki:name      "get" ] ;
    fuseki:endpoint [ fuseki:operation fuseki:gsp-rw ;
                      fuseki:name      "data" ] ;
    fuseki:endpoint [ fuseki:operation fuseki:upload ;
                      fuseki:name      "upload" ] ;
    fuseki:dataset  :text_dataset ;
.

# TDB

[] ja:loadClass "org.apache.jena.tdb2.TDB2" .

tdb2:DatasetTDB
    rdfs:subClassOf ja:RDFDataset .

tdb2:GraphTDB
    rdfs:subClassOf ja:Model .
# Text

[] ja:loadClass "org.apache.jena.query.text.TextQuery" .

text:TextDataset
    rdfs:subClassOf ja:RDFDataset .

text:TextIndexES
    rdfs:subClassOf text:TextIndex .

## ---------------------------------------------------------------
## This URI must be fixed - it's used to assemble the text dataset.

:text_dataset
    rdf:type     text:TextDataset ;
    text:dataset :base_dataset ;
    text:index   :indexEs ;
.

:base_dataset
    rdf:type      tdb2:DatasetTDB2 ;
    tdb2:location "E:/Java Projects/n8-engine/src/main/resources/tdb2/es";
.

:indexEs
    a                text:TextIndexES ;
#    text:directory     "src/main/resources/index-es" ;
    text:serverList  "127.0.0.1:9200" ;
    text:shards      "1" ;
# The number of shards for the index. Defaults to 1
    text:replicas    "1" ;
# The number of replicas for the index. Defaults to 1
    text:indexName   "text_dataset" ;
    text:clusterName "elasticsearch" ;
#    text:storeValues   true ;
#    text:analyzer      [ a text:StandardAnalyzer ] ;
#    text:queryAnalyzer [ a text:KeywordAnalyzer ] ;
#    text:queryParser   text:AnalyzingQueryParser ;
#    text:propLists ( [ . . . ] . . . ) ;
    text:entityMap   :entMap ;
.

:entMap
    a                 text:EntityMap ;
    text:entityField  "uri" ;
    text:defaultField "text" ;
    text:graphField   "graph" ;
## enable graph-specific indexing
    text:uidField     "uid" ;
## Must be defined in the text:maps
    text:langField    "lang" ;
    text:map          ( [ text:field     "text" ;
                          text:predicate rdfs:label ] ) .